fn texts(dir:File, l:vector<ref(File)>) {#block(1):void
  __ref_1(1):vector<ref(File)> = null;
  [2] {#For block(2):void
    _vector_1(2):vector<ref(File)>["__ref_1"] = _tp_File_files(dir(0), __ref_1(1));
    f#index(2):integer = -1i32;
    loop {#For loop_3
      f(3):ref(File)["_vector_1"] = {#iter next(4):ref(File)
        f#index(2):integer = OpAddInt(f#index(2), 1i32);
        OpGetVector(_vector_1(2), 17i32, f#index(2));
      }#iter next(4):ref(File);
      if OpNot(OpConvBoolFromRef(f(3))) {#break(5):void
        break(0);
      }#break(5):void else null;
      {#block(6):void
        [3] if OpEqInt(OpGetByte(f(3), 16i32, 0i32), 1i32) {#block(7):void
          [4] texts(f(3), l(0));
        }#block(7):void else if _tp_text_ends_with(OpGetText(f(3), 4i32), ".txt") {#block(8):void
          [6] _elm_2(8):ref(File)["l"] = OpNewRecord(l(0), 16i32, 65535i32);
          OpCopyRecord(f(3), _elm_2(8), 13i32);
          OpFinishRecord(l(0), _elm_2(8), 16i32, 65535i32);
        }#block(8):void else null;
      }#block(6):void;
    }#For loop_3;
  }#For block(2):void;
  OpFreeRef(__ref_1(1));
}#block(1):void

byte-code for tests/suite/13-file.lav:texts(dir: ref(File)[0], l: vector<ref(File)>[12])
   0[24]: return-address
   0[28]: ConvRefFromNull() -> ref(reference) var=__ref_1[32]:vector<ref(File)>
   1[40]: Database(var[32], db_tp=15)
   6[40]: VarRef(var[32]) -> ref(reference)
   9[52]: ConstInt(val=0) -> integer
  14[56]: SetInt(v1: ref(reference), fld=4, val: integer)
  17[40]: CreateRef(var[32]) -> ref(reference)
  20[52]: ConstInt(val=4) -> integer
  25[56]: SetByte(v1: ref(reference), fld=4, min=0, val: integer)
  30[40]: [2] VarRef(var[4]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=dir[4]:ref(File)
  33[52]: VarVector(var[32]) -> vector type=vector<File>[4]:Vector(13)[16] var=__ref_1[32]:vector<ref(File)>
  36[64]: Call(size=0, call=_tp_File_files[810])
  43[52]: ConstInt(val=-1) -> integer var=f#index[56]:integer
  48[56]: VarInt(var[56]) -> integer var=f#index[56]:integer
  51[60]: ConstInt(val=1) -> integer
  56[64]: AddInt(v1: integer, v2: integer) -> integer
  57[60]: PutInt(var[56], value: integer)
  60[56]: VarVector(var[44]) -> vector type=vector<File>[4]:Vector(13)[16] var=_vector_1[44]:vector<ref(File)>["__ref_1"]
  63[68]: VarInt(var[56]) -> integer var=f#index[56]:integer
  66[72]: GetVector(r: vector, size=17, index: integer) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13]
  69[68]: VarRef(var[60]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=f[60]:ref(File)["_vector_1"]
  72[80]: ConvBoolFromRef(val: ref(reference)) -> boolean
  73[69]: Not(v1: boolean) -> boolean
  74[69]: GotoFalseWord(jump=84, if_false: boolean)
  77[68]: FreeStack(value=0, discard=12)
  81[56]: GotoWord(jump=174)
  84[68]: [3] VarRef(var[60]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=f[60]:ref(File)["_vector_1"]
  87[80]: GetByte(v1: ref(reference), fld=16, min=0) -> integer
  92[72]: ConstInt(val=1) -> integer
  97[76]: EqInt(v1: integer, v2: integer) -> boolean
  98[69]: GotoFalseWord(jump=117, if_false: boolean)
 101[68]: [4] VarRef(var[60]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=f[60]:ref(File)["_vector_1"]
 104[80]: VarVector(var[16]) -> vector type=vector<File>[4]:Vector(13)[16] var=l[16]:vector<ref(File)>["__ref_2"]
 107[92]: Call(size=0, call=texts[1115])
 114[68]: GotoWord(jump=167)
 117[68]: VarRef(var[60]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=f[60]:ref(File)["_vector_1"]
 120[80]: GetText(v1: ref(reference), fld=4) -> text["dir"]
 123[84]: ConstText(_value=".txt") -> text
 129[100]: StaticCall(_tp_text_ends_with)
 132[69]: GotoFalseWord(jump=167, if_false: boolean)
 135[68]: [6] VarVector(var[16]) -> vector type=vector<File>[4]:Vector(13)[16] var=l[16]:vector<ref(File)>["__ref_2"]
 138[80]: NewRecord(data: ref(reference), parent_tp=16, fld=65535) -> ref(reference)
 143[80]: VarRef(var[60]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=f[60]:ref(File)["_vector_1"]
 146[92]: VarRef(var[72]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=_elm_2[72]:ref(File)["l"]
 149[104]: CopyRecord(data: ref(reference), to: ref(reference), tp=13)
 152[80]: VarVector(var[16]) -> vector type=vector<File>[4]:Vector(13)[16] var=l[16]:vector<ref(File)>["__ref_2"]
 155[92]: VarRef(var[72]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=_elm_2[72]:ref(File)["l"]
 158[104]: FinishRecord(data: ref(reference), rec: ref(reference), parent_tp=16, fld=65535)
 163[80]: FreeStack(value=0, discard=12)
 167[68]: FreeStack(value=0, discard=12)
 171[56]: GotoWord(jump=48)
 174[56]: FreeStack(value=0, discard=16)
 178[40]: VarVector(var[32]) -> vector type=vector<File>[4]:Vector(13)[16] var=__ref_1[32]:vector<ref(File)>
 181[52]: FreeRef(v1: ref(reference))
 182[40]: Return(ret=24, value=0, discard=40)

fn main() {#block(1):void
  __ref_3(1):vector<text> = null;
  __ref_2(1):ref(File) = null;
  __ref_1(1):ref(main_vector<File>) = null;
  __work_2(1):text = "";
  __work_1(1):text = "";
  [12] OpDatabase(__ref_1(1), 15i32);
  l(1):vector<ref(File)>["__ref_1"] = OpGetField(__ref_1(1), 4i32, 16i32);
  OpSetInt(__ref_1(1), 4i32, 0i32);
  [13] texts(file("example", __ref_2(1)), l(1));
  [14] if OpEqText(OpGetText(OpGetVector(l(1), 17i32, 0i32), 4i32), "example/config/terrain.txt") null else OpPanic({#Formatted string(2):text
    __work_1(1):text = "Found file '";
    OpFormatText(__work_1(1), OpGetText(OpGetVector(l(1), 17i32, 0i32), 4i32), 0i32, -1i32, 32i32);
    OpAppendText(__work_1(1), "'");
    __work_1(1);
  }#Formatted string(2):text);
  [15] f(1):ref(File)["l"] = OpGetVector(l(1), 17i32, 0i32);
  [16] c(1):vector<text>["__ref_3"] = _tp_File_lines(f(1), __ref_3(1));
  [17] if OpEqText(OpGetText(OpGetVector(c(1), 4i32, 1i32), 0i32), "   terrain = [") null else OpPanic({#Formatted string(3):text
    __work_2(1):text = "Line was '";
    OpFormatText(__work_2(1), OpGetText(OpGetVector(c(1), 4i32, 1i32), 0i32), 0i32, -1i32, 32i32);
    OpAppendText(__work_2(1), "'");
    __work_2(1);
  }#Formatted string(3):text);
  OpFreeRef(__ref_1(1));
  OpFreeText(__work_1(1));
  OpFreeRef(__ref_2(1));
  OpFreeText(__work_2(1));
  OpFreeRef(__ref_3(1));
}#block(1):void

byte-code for tests/suite/13-file.lav:main()
   0[0]: return-address
   0[4]: ConvRefFromNull() -> ref(reference) var=__ref_3[8]:vector<text>
   1[16]: Database(var[8], db_tp=14)
   6[16]: VarRef(var[8]) -> ref(reference)
   9[28]: ConstInt(val=0) -> integer
  14[32]: SetInt(v1: ref(reference), fld=4, val: integer)
  17[16]: CreateRef(var[8]) -> ref(reference)
  20[28]: ConstInt(val=4) -> integer
  25[32]: SetByte(v1: ref(reference), fld=4, min=0, val: integer)
  30[16]: ConvRefFromNull() -> ref(reference) var=__ref_2[20]:ref(File)
  31[28]: ConvRefFromNull() -> ref(reference) var=__ref_1[32]:ref(main_vector<File>)
  32[40]: Text() var=__work_2[44]:text
  33[64]: Text() var=__work_1[68]:text
  34[88]: [12] Database(var[32], db_tp=15) type=main_vector<File>[8]:{vector:vector<File>[4]}[15]
  39[88]: VarRef(var[32]) -> ref(reference) type=main_vector<File>[8]:{vector:vector<File>[4]}[15] var=__ref_1[32]:ref(main_vector<File>)
  42[100]: GetField(v1: ref(reference), fld=4) -> ref(reference) type=vector<File>[4]:Vector(13)[16]
  45[100]: VarRef(var[32]) -> ref(reference) type=main_vector<File>[8]:{vector:vector<File>[4]}[15] var=__ref_1[32]:ref(main_vector<File>)
  48[112]: ConstInt(val=0) -> integer
  53[116]: SetInt(v1: ref(reference), fld=4, val: integer)
  56[100]: [13] ConstText(_value="example") -> text
  65[116]: VarRef(var[20]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=__ref_2[20]:ref(File)
  68[128]: Call(size=0, call=file[736])
  75[112]: VarVector(var[92]) -> vector type=vector<File>[4]:Vector(13)[16] var=l[92]:vector<ref(File)>["__ref_1"]
  78[124]: Call(size=0, call=texts[1115])
  85[100]: [14] VarVector(var[92]) -> vector type=vector<File>[4]:Vector(13)[16] var=l[92]:vector<ref(File)>["__ref_1"]
  88[112]: ConstInt(val=0) -> integer
  93[116]: GetVector(r: vector, size=17, index: integer) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13]
  96[112]: GetText(v1: ref(reference), fld=4) -> text["l"]
  99[116]: ConstText(_value="example/config/terrain.txt") -> text
 127[132]: EqText(v1: text, v2: text) -> boolean
 128[101]: GotoFalseWord(jump=134, if_false: boolean)
 131[100]: GotoWord(jump=188)
 134[100]: ClearText(var[68]) var=__work_1[68]:text
 137[100]: ConstText(_value="Found file '") -> text
 151[116]: AppendText(var[68], v1: text)
 154[100]: VarVector(var[92]) -> vector type=vector<File>[4]:Vector(13)[16] var=l[92]:vector<ref(File)>["__ref_1"]
 157[112]: ConstInt(val=0) -> integer
 162[116]: GetVector(r: vector, size=17, index: integer) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13]
 165[112]: GetText(v1: ref(reference), fld=4) -> text["l"]
 168[116]: ConstInt(val=0) -> integer
 173[120]: FormatText(var[68], val: text, width: integer, dir=-1, token=32)
 178[100]: ConstText(_value="'") -> text
 181[116]: AppendText(var[68], v1: text)
 184[100]: VarText(var[68]) -> text var=__work_1[68]:text
 187[116]: Panic(message: text)
 188[100]: [15] VarVector(var[92]) -> vector type=vector<File>[4]:Vector(13)[16] var=l[92]:vector<ref(File)>["__ref_1"]
 191[112]: ConstInt(val=0) -> integer
 196[116]: GetVector(r: vector, size=17, index: integer) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13]
 199[112]: [16] VarRef(var[104]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=f[104]:ref(File)["l"]
 202[124]: VarVector(var[8]) -> vector type=vector<text>[4]:Vector(5)[7] var=__ref_3[8]:vector<text>
 205[136]: Call(size=0, call=_tp_File_lines[495])
 212[124]: [17] VarVector(var[116]) -> vector type=vector<text>[4]:Vector(5)[7] var=c[116]:vector<text>["__ref_3"]
 215[136]: ConstInt(val=1) -> integer
 220[140]: GetVector(r: vector, size=4, index: integer) -> ref(reference) type=text[4]:Base[5]
 223[136]: GetText(v1: ref(reference), fld=0) -> text["l"]
 226[140]: ConstText(_value="   terrain = [") -> text
 242[156]: EqText(v1: text, v2: text) -> boolean
 243[125]: GotoFalseWord(jump=249, if_false: boolean)
 246[124]: GotoWord(jump=301)
 249[124]: ClearText(var[44]) var=__work_2[44]:text
 252[124]: ConstText(_value="Line was '") -> text
 264[140]: AppendText(var[44], v1: text)
 267[124]: VarVector(var[116]) -> vector type=vector<text>[4]:Vector(5)[7] var=c[116]:vector<text>["__ref_3"]
 270[136]: ConstInt(val=1) -> integer
 275[140]: GetVector(r: vector, size=4, index: integer) -> ref(reference) type=text[4]:Base[5]
 278[136]: GetText(v1: ref(reference), fld=0) -> text["l"]
 281[140]: ConstInt(val=0) -> integer
 286[144]: FormatText(var[44], val: text, width: integer, dir=-1, token=32)
 291[124]: ConstText(_value="'") -> text
 294[140]: AppendText(var[44], v1: text)
 297[124]: VarText(var[44]) -> text var=__work_2[44]:text
 300[140]: Panic(message: text)
 301[124]: VarRef(var[32]) -> ref(reference) type=main_vector<File>[8]:{vector:vector<File>[4]}[15] var=__ref_1[32]:ref(main_vector<File>)
 304[136]: FreeRef(v1: ref(reference))
 305[124]: FreeText(var[68])
 308[124]: VarRef(var[20]) -> ref(reference) type=File[17]:{path:text[4], size:long[8], dir:boolean[16]}[13] var=__ref_2[20]:ref(File)
 311[136]: FreeRef(v1: ref(reference))
 312[124]: FreeText(var[44])
 315[124]: VarVector(var[8]) -> vector type=vector<text>[4]:Vector(5)[7] var=__ref_3[8]:vector<text>
 318[136]: FreeRef(v1: ref(reference))
 319[124]: Return(ret=0, value=0, discard=124)

