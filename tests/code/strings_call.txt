fn choice(a: text, b: text) -> text { if len(a) > len(b) { a } else { b } }

pub fn test() {
    test_value = {choice("{1:03}", "{2}1") + choice("2", "")};
    assert(
        test_value == "0012",
        "Test failed {test_value} != \"0012\""
    );
}
fn choice(a:text, b:text) -> text["a", "b"] {#1 block
  if OpGtInt(_tp_text_len(a), _tp_text_len(b)) {#2 block
    a;
  }#2:text["a"] else {#3 block
    b;
  }#3:text["b"];
}#1:text["a", "b"]

byte-code for call:choice(a: text[0], b: text[16]) -> text["a", "b"]
 655[32]: return-address
 655[36]: ArgText(var[0]) -> text var=a[0]:text in 0
 658[52]: Call(size=0, to=318)
 665[40]: ArgText(var[16]) -> text var=b[16]:text in 0
 668[56]: Call(size=0, to=318)
 675[44]: GtInt(v1: integer, v2: integer) -> boolean
 676[37]: GotoFalseWord(jump=685, if_false: boolean)
 679[36]: ArgText(var[0]) -> text var=a[0]:text in 0
 682[52]: GotoWord(jump=688)
 685[36]: ArgText(var[16]) -> text var=b[16]:text in 0
 688[52]: Return(ret=32, value=16, discard=52) type=text[4]:Base[5]

fn test() {#1 block
  __work_4:text = "";
  __work_3:text = "";
  __work_2:text = "";
  __work_1:text = "";
  test_value:text["__work_3"] = {#2 block
    __work_3:text = choice({#3 formatting string
      __work_1:text = "";
      OpFormatInt(__work_1, 1i32, 10i32, 3i32, 48i32, false, false);
      __work_1;
    }#3:text, {#4 formatting string
      __work_2:text = "";
      OpFormatInt(__work_2, 2i32, 10i32, 0i32, 32i32, false, false);
      OpAppendText(__work_2, "1");
      __work_2;
    }#4:text);
    OpAppendText(__work_3, choice("2", ""));
    __work_3;
  }#2:text["__work_3"];
  if OpEqText(test_value, "0012") null else OpPanic({#5 formatting string
    __work_4:text = "Test failed ";
    OpFormatText(__work_4, test_value, 0i32, -1i32, 32i32);
    OpAppendText(__work_4, " != "0012"");
    __work_4;
  }#5:text);
}#1

byte-code for call:test()
 694[0]: return-address
 694[4]: Text() var=__work_4[4]:text in 1
 695[28]: Text() var=__work_3[28]:text in 1
 696[52]: Text() var=__work_2[52]:text in 1
 697[76]: Text() var=__work_1[76]:text in 1
 698[100]: Text() var=test_value[100]:text["__work_3"] in 1
 699[124]: ClearText(var[28]) var=__work_3[28]:text in 1
 702[124]: ClearText(var[76]) var=__work_1[76]:text in 1
 705[124]: ConstText(_value="") -> text
 707[140]: AppendText(var[76], v1: text)
 710[124]: ConstInt(val=1) -> integer
 715[128]: ConstInt(val=3) -> integer
 720[132]: FormatInt(var[76], val: integer, radix=10, width: integer, token=48, plus=false, note=false)
 727[124]: VarText(var[76]) -> text var=__work_1[76]:text in 1
 730[140]: ClearText(var[52]) var=__work_2[52]:text in 1
 733[140]: ConstText(_value="") -> text
 735[156]: AppendText(var[52], v1: text)
 738[140]: ConstInt(val=2) -> integer
 743[144]: ConstInt(val=0) -> integer
 748[148]: FormatInt(var[52], val: integer, radix=10, width: integer, token=32, plus=false, note=false)
 755[140]: ConstText(_value="1") -> text
 758[156]: AppendText(var[52], v1: text)
 761[140]: VarText(var[52]) -> text var=__work_2[52]:text in 1
 764[156]: Call(size=0, to=655)
 771[140]: AppendText(var[28], v1: text)
 774[124]: ConstText(_value="2") -> text
 777[140]: ConstText(_value="") -> text
 779[156]: Call(size=0, to=655)
 786[140]: AppendText(var[28], v1: text)
 789[124]: VarText(var[28]) -> text var=__work_3[28]:text in 1
 792[140]: AppendText(var[100], v1: text)
 795[124]: VarText(var[100]) -> text var=test_value[100]:text["__work_3"] in 1
 798[140]: ConstText(_value="0012") -> text
 804[156]: EqText(v1: text, v2: text) -> boolean
 805[125]: GotoFalseWord(jump=811, if_false: boolean)
 808[124]: GotoWord(jump=863)
 811[124]: ClearText(var[4]) var=__work_4[4]:text in 1
 814[124]: ConstText(_value="Test failed ") -> text
 828[140]: AppendText(var[4], v1: text)
 831[124]: VarText(var[100]) -> text var=test_value[100]:text["__work_3"] in 1
 834[140]: ConstInt(val=0) -> integer
 839[144]: FormatText(var[4], val: text, width: integer, dir=-1, token=32)
 844[124]: ConstText(_value=" != "0012"") -> text
 856[140]: AppendText(var[4], v1: text)
 859[124]: VarText(var[4]) -> text var=__work_4[4]:text in 1
 862[140]: Panic(message: text)
 863[124]: FreeText(var[100])
 866[124]: FreeText(var[76])
 869[124]: FreeText(var[52])
 872[124]: FreeText(var[28])
 875[124]: FreeText(var[4])
 878[124]: Return(ret=0, value=0, discard=124)

Execute test:
  694:[8] Text()
  695:[32] Text()
  696:[56] Text()
  697:[80] Text()
  698:[104] Text()
  699:[128] ClearText(var[32])
  702:[128] ClearText(var[80])
  705:[128] ConstText(_value="") -> ""[128]
  707:[144] AppendText(var[80], v1=""[128])
  710:[128] ConstInt(val=1) -> 1[128]
  715:[132] ConstInt(val=3) -> 3[132]
  720:[136] FormatInt(var[80], val=1[128], radix=10, width=3[132], token=48, plus=false, note=false)
  727:[128] VarText(var[80]) -> "001"[128]
  730:[144] ClearText(var[56])
  733:[144] ConstText(_value="") -> ""[144]
  735:[160] AppendText(var[56], v1=""[144])
  738:[144] ConstInt(val=2) -> 2[144]
  743:[148] ConstInt(val=0) -> 0[148]
  748:[152] FormatInt(var[56], val=2[144], radix=10, width=0[148], token=32, plus=false, note=false)
  755:[144] ConstText(_value="1") -> "1"[144]
  758:[160] AppendText(var[56], v1="1"[144])
  761:[144] VarText(var[56]) -> "21"[144]
  764:[160] Call(size=0, to=655)
  655:[164] ArgText(var[128]) -> "001"[164]
  658:[180] Call(size=0, to=318)
  318:[184] ArgText(var[164]) -> "001"[184]
  321:[200] LengthText(v1="001"[184]) -> 3[184]
  322:[188] Return(ret=665[180], value=4, discard=24) -> 3[164]
  665:[168] ArgText(var[144]) -> "21"[168]
  668:[184] Call(size=0, to=318)
  318:[188] ArgText(var[168]) -> "21"[188]
  321:[204] LengthText(v1="21"[188]) -> 2[188]
  322:[192] Return(ret=675[184], value=4, discard=24) -> 2[168]
  675:[172] GtInt(v1=3[164], v2=2[168]) -> true[164]
  676:[165] GotoFalseWord(jump=685, if_false=true[164])
  679:[164] ArgText(var[128]) -> "001"[164]
  682:[180] GotoWord(jump=688)
  688:[180] Return(ret=771[160], value=16, discard=52) -> "001"[128]
  771:[144] AppendText(var[32], v1="001"[128])
  774:[128] ConstText(_value="2") -> "2"[128]
  777:[144] ConstText(_value="") -> ""[144]
  779:[160] Call(size=0, to=655)
  655:[164] ArgText(var[128]) -> "2"[164]
  658:[180] Call(size=0, to=318)
  318:[184] ArgText(var[164]) -> "2"[184]
  321:[200] LengthText(v1="2"[184]) -> 1[184]
  322:[188] Return(ret=665[180], value=4, discard=24) -> 1[164]
  665:[168] ArgText(var[144]) -> ""[168]
  668:[184] Call(size=0, to=318)
  318:[188] ArgText(var[168]) -> ""[188]
  321:[204] LengthText(v1=""[188]) -> 0[188]
  322:[192] Return(ret=675[184], value=4, discard=24) -> 0[168]
  675:[172] GtInt(v1=1[164], v2=0[168]) -> true[164]
  676:[165] GotoFalseWord(jump=685, if_false=true[164])
  679:[164] ArgText(var[128]) -> "2"[164]
  682:[180] GotoWord(jump=688)
  688:[180] Return(ret=786[160], value=16, discard=52) -> "2"[128]
  786:[144] AppendText(var[32], v1="2"[128])
  789:[128] VarText(var[32]) -> "0012"[128]
  792:[144] AppendText(var[104], v1="0012"[128])
  795:[128] VarText(var[104]) -> "0012"[128]
  798:[144] ConstText(_value="0012") -> "0012"[144]
  804:[160] EqText(v1="0012"[128], v2="0012"[144]) -> true[128]
  805:[129] GotoFalseWord(jump=811, if_false=true[128])
  808:[128] GotoWord(jump=863)
  863:[128] FreeText(var[104])
  866:[128] FreeText(var[80])
  869:[128] FreeText(var[56])
  872:[128] FreeText(var[32])
  875:[128] FreeText(var[8])
  878:[128] Return(ret=4294967295[4], value=0, discard=124)
Finished
