pub fn test() {
    test_value = {txt="12ðŸ˜ŠðŸ™ƒ45"; "a{for c in txt[2..-1] {"{c#index}:{c}"}}b"};
    assert(
        test_value == "a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b",
        "Test failed {test_value} != \"a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b\""
    );
}
fn test() {#block(1):void
  __work_3(1):text = "";
  __work_2(1):text = "";
  __work_1(1):text = "";
  test_value(1):text = {#block(2):text
    txt(2):text = "12ðŸ˜ŠðŸ™ƒ45";
    {#Formatted string(3):text
      __work_1(1):text = "a";
      OpAppendText(__work_1(1), "[");
      c#index(3):integer = 0i32;
      c#count(3):integer = 0i32;
      loop {#Append Iter_4
        _val_1(4):text = {#Iter For(5):text
          c(5):character = {#for text next(6):character
            _for_result_2(6):character = OpTextCharacter(OpGetTextSub(txt(2), 2i32, OpMinSingleInt(1i32)), c#index(3));
            c#index(3):integer = OpAddInt(c#index(3), OpLengthCharacter(_for_result_2(6)));
            _for_result_2(6);
          }#for text next(6):character;
          if OpNot(OpConvBoolFromCharacter(c(5))) {#break(7):void
            OpFreeText(_val_1(4));
            break(0);
          }#break(7):void else null;
          {#block(8):text
            {#Formatted string(9):text
              __work_2(1):text = "";
              OpFormatInt(__work_2(1), c#index(3), 10i32, 0i32, 32i32, false, false);
              OpAppendText(__work_2(1), ":");
              OpAppendCharacter(__work_2(1), c(5));
              __work_2(1);
            }#Formatted string(9):text;
          }#block(8):text;
        }#Iter For(5):text;
        if OpGtInt(c#count(3), 0i32) OpAppendText(__work_1(1), ",") else null;
        c#count(3):integer = OpAddInt(c#count(3), 1i32);
        OpFormatText(__work_1(1), _val_1(4), 0i32, -1i32, 32i32);
        OpFreeText(_val_1(4));
      }#Append Iter_4;
      OpAppendText(__work_1(1), "]");
      OpAppendText(__work_1(1), "b");
      OpFreeText(txt(2));
      __work_1(1);
    }#Formatted string(3):text;
  }#block(2):text;
  if OpEqText(test_value(1), "a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b") null else OpPanic({#Formatted string(10):text
    __work_3(1):text = "Test failed ";
    OpFormatText(__work_3(1), test_value(1), 0i32, -1i32, 32i32);
    OpAppendText(__work_3(1), " != "a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"");
    __work_3(1);
  }#Formatted string(10):text);
  OpFreeText(test_value(1));
  OpFreeText(__work_1(1));
  OpFreeText(__work_2(1));
  OpFreeText(__work_3(1));
}#block(1):void

byte-code for format_chars:test() [1074]
   0[0]: return-address
   0[4]: Text() var=__work_3[8]:text
   1[28]: Text() var=__work_2[32]:text
   2[52]: Text() var=__work_1[56]:text
   3[76]: Text() var=test_value[80]:text
   4[100]: Text() var=txt[104]:text
   5[124]: ConstText(_value="12ðŸ˜ŠðŸ™ƒ45") -> text
  19[140]: AppendText(var[104], v1: text)
  22[124]: ClearText(var[56]) var=__work_1[56]:text
  25[124]: ConstText(_value="a") -> text
  28[140]: AppendText(var[56], v1: text)
  31[124]: ConstText(_value="[") -> text
  34[140]: AppendText(var[56], v1: text)
  37[124]: ConstInt(val=0) -> integer var=c#index[128]:integer
  42[128]: ConstInt(val=0) -> integer var=c#count[132]:integer
  47[132]: Text() var=_val_1[136]:text
  48[156]: VarText(var[104]) -> text var=txt[104]:text
  51[172]: ConstInt(val=2) -> integer
  56[176]: ConstInt(val=1) -> integer
  61[180]: MinSingleInt(v1: integer) -> integer
  62[180]: GetTextSub(v1: text, from: integer, till: integer) -> text["test_value"]
  63[172]: VarInt(var[128]) -> integer var=c#index[128]:integer
  66[176]: TextCharacter(v1: text, v2: integer) -> character
  67[160]: VarInt(var[128]) -> integer var=c#index[128]:integer
  70[164]: VarCharacter(var[160]) -> character var=_for_result_2[160]:character
  73[168]: LengthCharacter(v1: character) -> integer
  74[168]: AddInt(v1: integer, v2: integer) -> integer
  75[164]: PutInt(var[128], value: integer)
  78[160]: VarCharacter(var[160]) -> character var=_for_result_2[160]:character
  81[164]: FreeStack(value=4, discard=8)
  85[160]: VarCharacter(var[160]) -> character var=c[160]:character
  88[164]: ConvBoolFromCharacter(v1: character) -> boolean
  89[161]: Not(v1: boolean) -> boolean
  90[161]: GotoFalseWord(jump=103, if_false: boolean)
  93[160]: FreeText(var[136])
  96[160]: FreeStack(value=0, discard=28)
 100[132]: GotoWord(jump=201)
 103[160]: ClearText(var[32]) var=__work_2[32]:text
 106[160]: ConstText(_value="") -> text
 108[176]: AppendText(var[32], v1: text)
 111[160]: VarInt(var[128]) -> integer var=c#index[128]:integer
 114[164]: ConstInt(val=0) -> integer
 119[168]: FormatInt(var[32], val: integer, radix=10, width: integer, token=32, plus=false, note=false)
 126[160]: ConstText(_value=":") -> text
 129[176]: AppendText(var[32], v1: text)
 132[160]: VarCharacter(var[160]) -> character var=c[160]:character
 135[164]: AppendCharacter(var[32], v1: character)
 138[160]: VarText(var[32]) -> text var=__work_2[32]:text
 141[176]: FreeStack(value=16, discard=20)
 145[172]: AppendText(var[136], v1: text)
 148[156]: VarInt(var[132]) -> integer var=c#count[132]:integer
 151[160]: ConstInt(val=0) -> integer
 156[164]: GtInt(v1: integer, v2: integer) -> boolean
 157[157]: GotoFalseWord(jump=166, if_false: boolean)
 160[156]: ConstText(_value=",") -> text
 163[172]: AppendText(var[56], v1: text)
 166[156]: VarInt(var[132]) -> integer var=c#count[132]:integer
 169[160]: ConstInt(val=1) -> integer
 174[164]: AddInt(v1: integer, v2: integer) -> integer
 175[160]: PutInt(var[132], value: integer)
 178[156]: VarText(var[136]) -> text var=_val_1[136]:text
 181[172]: ConstInt(val=0) -> integer
 186[176]: FormatText(var[56], val: text, width: integer, dir=-1, token=32)
 191[156]: FreeText(var[136])
 194[156]: FreeStack(value=0, discard=24)
 198[132]: GotoWord(jump=47)
 201[132]: ConstText(_value="]") -> text
 204[148]: AppendText(var[56], v1: text)
 207[132]: ConstText(_value="b") -> text
 210[148]: AppendText(var[56], v1: text)
 213[132]: FreeText(var[104])
 216[132]: VarText(var[56]) -> text var=__work_1[56]:text
 219[148]: FreeStack(value=16, discard=24)
 223[140]: FreeStack(value=16, discard=40)
 227[116]: AppendText(var[80], v1: text)
 230[100]: VarText(var[80]) -> text var=test_value[80]:text
 233[116]: ConstText(_value="a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b") -> text
 256[132]: EqText(v1: text, v2: text) -> boolean
 257[101]: GotoFalseWord(jump=263, if_false: boolean)
 260[100]: GotoWord(jump=332)
 263[100]: ClearText(var[8]) var=__work_3[8]:text
 266[100]: ConstText(_value="Test failed ") -> text
 280[116]: AppendText(var[8], v1: text)
 283[100]: VarText(var[80]) -> text var=test_value[80]:text
 286[116]: ConstInt(val=0) -> integer
 291[120]: FormatText(var[8], val: text, width: integer, dir=-1, token=32)
 296[100]: ConstText(_value=" != "a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"") -> text
 325[116]: AppendText(var[8], v1: text)
 328[100]: VarText(var[8]) -> text var=__work_3[8]:text
 331[116]: Panic(message: text)
 332[100]: FreeText(var[80])
 335[100]: FreeText(var[56])
 338[100]: FreeText(var[32])
 341[100]: FreeText(var[8])
 344[100]: Return(ret=0, value=0, discard=100)

Execute test:
    0:[8] Text()
    1:[32] Text()
    2:[56] Text()
    3:[80] Text()
    4:[104] Text()
    5:[128] ConstText(_value="12ðŸ˜ŠðŸ™ƒ45") -> "12ðŸ˜ŠðŸ™ƒ45"[128]
   19:[144] AppendText(var[104], v1="12ðŸ˜ŠðŸ™ƒ45"[128])
   22:[128] ClearText(var[56])
   25:[128] ConstText(_value="a") -> "a"[128]
   28:[144] AppendText(var[56], v1="a"[128])
   31:[128] ConstText(_value="[") -> "["[128]
   34:[144] AppendText(var[56], v1="["[128])
   37:[128] ConstInt(val=0) -> 0[128]
   42:[132] ConstInt(val=0) -> 0[132]
   47:[136] Text()
   48:[160] VarText(var[104]) -> "12ðŸ˜ŠðŸ™ƒ45"[160]
   51:[176] ConstInt(val=2) -> 2[176]
   56:[180] ConstInt(val=1) -> 1[180]
   61:[184] MinSingleInt(v1=1[180]) -> -1[180]
   62:[184] GetTextSub(v1="12ðŸ˜ŠðŸ™ƒ45"[160], from=2[176], till=-1[180]) -> "ðŸ˜ŠðŸ™ƒ4"[160]
   63:[176] VarInt(var[128]) -> 0[176]
   66:[180] TextCharacter(v1="ðŸ˜ŠðŸ™ƒ4"[160], v2=0[176]) -> 'ðŸ˜Š'[160]
   67:[164] VarInt(var[128]) -> 0[164]
   70:[168] VarCharacter(var[160]) -> 'ðŸ˜Š'[168]
   73:[172] LengthCharacter(v1='ðŸ˜Š'[168]) -> 4[168]
   74:[172] AddInt(v1=0[164], v2=4[168]) -> 4[164]
   75:[168] PutInt(var[128], value=4[164])
   78:[164] VarCharacter(var[160]) -> 'ðŸ˜Š'[164]
   81:[168] FreeStack(value=4, discard=8)
   85:[164] VarCharacter(var[160]) -> 'ðŸ˜Š'[164]
   88:[168] ConvBoolFromCharacter(v1='ðŸ˜Š'[164]) -> true[164]
   89:[165] Not(v1=true[164]) -> false[164]
   90:[165] GotoFalseWord(jump=103, if_false=false[164])
  103:[164] ClearText(var[32])
  106:[164] ConstText(_value="") -> ""[164]
  108:[180] AppendText(var[32], v1=""[164])
  111:[164] VarInt(var[128]) -> 4[164]
  114:[168] ConstInt(val=0) -> 0[168]
  119:[172] FormatInt(var[32], val=4[164], radix=10, width=0[168], token=32, plus=false, note=false)
  126:[164] ConstText(_value=":") -> ":"[164]
  129:[180] AppendText(var[32], v1=":"[164])
  132:[164] VarCharacter(var[160]) -> 'ðŸ˜Š'[164]
  135:[168] AppendCharacter(var[32], v1='ðŸ˜Š'[164])
  138:[164] VarText(var[32]) -> "4:ðŸ˜Š"[164]
  141:[180] FreeStack(value=16, discard=20)
  145:[176] AppendText(var[136], v1="4:ðŸ˜Š"[160])
  148:[160] VarInt(var[132]) -> 0[160]
  151:[164] ConstInt(val=0) -> 0[164]
  156:[168] GtInt(v1=0[160], v2=0[164]) -> false[160]
  157:[161] GotoFalseWord(jump=166, if_false=false[160])
  166:[160] VarInt(var[132]) -> 0[160]
  169:[164] ConstInt(val=1) -> 1[164]
  174:[168] AddInt(v1=0[160], v2=1[164]) -> 1[160]
  175:[164] PutInt(var[132], value=1[160])
  178:[160] VarText(var[136]) -> "4:ðŸ˜Š"[160]
  181:[176] ConstInt(val=0) -> 0[176]
  186:[180] FormatText(var[56], val="4:ðŸ˜Š"[160], width=0[176], dir=-1, token=32)
  191:[160] FreeText(var[136])
  194:[160] FreeStack(value=0, discard=24)
  198:[136] GotoWord(jump=47)
   47:[136] Text()
   48:[160] VarText(var[104]) -> "12ðŸ˜ŠðŸ™ƒ45"[160]
   51:[176] ConstInt(val=2) -> 2[176]
   56:[180] ConstInt(val=1) -> 1[180]
   61:[184] MinSingleInt(v1=1[180]) -> -1[180]
   62:[184] GetTextSub(v1="12ðŸ˜ŠðŸ™ƒ45"[160], from=2[176], till=-1[180]) -> "ðŸ˜ŠðŸ™ƒ4"[160]
   63:[176] VarInt(var[128]) -> 4[176]
   66:[180] TextCharacter(v1="ðŸ˜ŠðŸ™ƒ4"[160], v2=4[176]) -> 'ðŸ™ƒ'[160]
   67:[164] VarInt(var[128]) -> 4[164]
   70:[168] VarCharacter(var[160]) -> 'ðŸ™ƒ'[168]
   73:[172] LengthCharacter(v1='ðŸ™ƒ'[168]) -> 4[168]
   74:[172] AddInt(v1=4[164], v2=4[168]) -> 8[164]
   75:[168] PutInt(var[128], value=8[164])
   78:[164] VarCharacter(var[160]) -> 'ðŸ™ƒ'[164]
   81:[168] FreeStack(value=4, discard=8)
   85:[164] VarCharacter(var[160]) -> 'ðŸ™ƒ'[164]
   88:[168] ConvBoolFromCharacter(v1='ðŸ™ƒ'[164]) -> true[164]
   89:[165] Not(v1=true[164]) -> false[164]
   90:[165] GotoFalseWord(jump=103, if_false=false[164])
  103:[164] ClearText(var[32])
  106:[164] ConstText(_value="") -> ""[164]
  108:[180] AppendText(var[32], v1=""[164])
  111:[164] VarInt(var[128]) -> 8[164]
  114:[168] ConstInt(val=0) -> 0[168]
  119:[172] FormatInt(var[32], val=8[164], radix=10, width=0[168], token=32, plus=false, note=false)
  126:[164] ConstText(_value=":") -> ":"[164]
  129:[180] AppendText(var[32], v1=":"[164])
  132:[164] VarCharacter(var[160]) -> 'ðŸ™ƒ'[164]
  135:[168] AppendCharacter(var[32], v1='ðŸ™ƒ'[164])
  138:[164] VarText(var[32]) -> "8:ðŸ™ƒ"[164]
  141:[180] FreeStack(value=16, discard=20)
  145:[176] AppendText(var[136], v1="8:ðŸ™ƒ"[160])
  148:[160] VarInt(var[132]) -> 1[160]
  151:[164] ConstInt(val=0) -> 0[164]
  156:[168] GtInt(v1=1[160], v2=0[164]) -> true[160]
  157:[161] GotoFalseWord(jump=166, if_false=true[160])
  160:[160] ConstText(_value=",") -> ","[160]
  163:[176] AppendText(var[56], v1=","[160])
  166:[160] VarInt(var[132]) -> 1[160]
  169:[164] ConstInt(val=1) -> 1[164]
  174:[168] AddInt(v1=1[160], v2=1[164]) -> 2[160]
  175:[164] PutInt(var[132], value=2[160])
  178:[160] VarText(var[136]) -> "8:ðŸ™ƒ"[160]
  181:[176] ConstInt(val=0) -> 0[176]
  186:[180] FormatText(var[56], val="8:ðŸ™ƒ"[160], width=0[176], dir=-1, token=32)
  191:[160] FreeText(var[136])
  194:[160] FreeStack(value=0, discard=24)
  198:[136] GotoWord(jump=47)
   47:[136] Text()
   48:[160] VarText(var[104]) -> "12ðŸ˜ŠðŸ™ƒ45"[160]
   51:[176] ConstInt(val=2) -> 2[176]
   56:[180] ConstInt(val=1) -> 1[180]
   61:[184] MinSingleInt(v1=1[180]) -> -1[180]
   62:[184] GetTextSub(v1="12ðŸ˜ŠðŸ™ƒ45"[160], from=2[176], till=-1[180]) -> "ðŸ˜ŠðŸ™ƒ4"[160]
   63:[176] VarInt(var[128]) -> 8[176]
   66:[180] TextCharacter(v1="ðŸ˜ŠðŸ™ƒ4"[160], v2=8[176]) -> '4'[160]
   67:[164] VarInt(var[128]) -> 8[164]
   70:[168] VarCharacter(var[160]) -> '4'[168]
   73:[172] LengthCharacter(v1='4'[168]) -> 1[168]
   74:[172] AddInt(v1=8[164], v2=1[168]) -> 9[164]
   75:[168] PutInt(var[128], value=9[164])
   78:[164] VarCharacter(var[160]) -> '4'[164]
   81:[168] FreeStack(value=4, discard=8)
   85:[164] VarCharacter(var[160]) -> '4'[164]
   88:[168] ConvBoolFromCharacter(v1='4'[164]) -> true[164]
   89:[165] Not(v1=true[164]) -> false[164]
   90:[165] GotoFalseWord(jump=103, if_false=false[164])
  103:[164] ClearText(var[32])
  106:[164] ConstText(_value="") -> ""[164]
  108:[180] AppendText(var[32], v1=""[164])
  111:[164] VarInt(var[128]) -> 9[164]
  114:[168] ConstInt(val=0) -> 0[168]
  119:[172] FormatInt(var[32], val=9[164], radix=10, width=0[168], token=32, plus=false, note=false)
  126:[164] ConstText(_value=":") -> ":"[164]
  129:[180] AppendText(var[32], v1=":"[164])
  132:[164] VarCharacter(var[160]) -> '4'[164]
  135:[168] AppendCharacter(var[32], v1='4'[164])
  138:[164] VarText(var[32]) -> "9:4"[164]
  141:[180] FreeStack(value=16, discard=20)
  145:[176] AppendText(var[136], v1="9:4"[160])
  148:[160] VarInt(var[132]) -> 2[160]
  151:[164] ConstInt(val=0) -> 0[164]
  156:[168] GtInt(v1=2[160], v2=0[164]) -> true[160]
  157:[161] GotoFalseWord(jump=166, if_false=true[160])
  160:[160] ConstText(_value=",") -> ","[160]
  163:[176] AppendText(var[56], v1=","[160])
  166:[160] VarInt(var[132]) -> 2[160]
  169:[164] ConstInt(val=1) -> 1[164]
  174:[168] AddInt(v1=2[160], v2=1[164]) -> 3[160]
  175:[164] PutInt(var[132], value=3[160])
  178:[160] VarText(var[136]) -> "9:4"[160]
  181:[176] ConstInt(val=0) -> 0[176]
  186:[180] FormatText(var[56], val="9:4"[160], width=0[176], dir=-1, token=32)
  191:[160] FreeText(var[136])
  194:[160] FreeStack(value=0, discard=24)
  198:[136] GotoWord(jump=47)
   47:[136] Text()
   48:[160] VarText(var[104]) -> "12ðŸ˜ŠðŸ™ƒ45"[160]
   51:[176] ConstInt(val=2) -> 2[176]
   56:[180] ConstInt(val=1) -> 1[180]
   61:[184] MinSingleInt(v1=1[180]) -> -1[180]
   62:[184] GetTextSub(v1="12ðŸ˜ŠðŸ™ƒ45"[160], from=2[176], till=-1[180]) -> "ðŸ˜ŠðŸ™ƒ4"[160]
   63:[176] VarInt(var[128]) -> 9[176]
   66:[180] TextCharacter(v1="ðŸ˜ŠðŸ™ƒ4"[160], v2=9[176]) -> null[160]
   67:[164] VarInt(var[128]) -> 9[164]
   70:[168] VarCharacter(var[160]) -> null[168]
   73:[172] LengthCharacter(v1=null[168]) -> 0[168]
   74:[172] AddInt(v1=9[164], v2=0[168]) -> 9[164]
   75:[168] PutInt(var[128], value=9[164])
   78:[164] VarCharacter(var[160]) -> null[164]
   81:[168] FreeStack(value=4, discard=8)
   85:[164] VarCharacter(var[160]) -> null[164]
   88:[168] ConvBoolFromCharacter(v1=null[164]) -> false[164]
   89:[165] Not(v1=false[164]) -> true[164]
   90:[165] GotoFalseWord(jump=103, if_false=true[164])
   93:[164] FreeText(var[136])
   96:[164] FreeStack(value=0, discard=28)
  100:[136] GotoWord(jump=201)
  201:[136] ConstText(_value="]") -> "]"[136]
  204:[152] AppendText(var[56], v1="]"[136])
  207:[136] ConstText(_value="b") -> "b"[136]
  210:[152] AppendText(var[56], v1="b"[136])
  213:[136] FreeText(var[104])
  216:[136] VarText(var[56]) -> "a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"[136]
  219:[152] FreeStack(value=16, discard=24)
  223:[144] FreeStack(value=16, discard=40)
  227:[120] AppendText(var[80], v1="a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"[104])
  230:[104] VarText(var[80]) -> "a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"[104]
  233:[120] ConstText(_value="a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b") -> "a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"[120]
  256:[136] EqText(v1="a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"[104], v2="a[4:ðŸ˜Š,8:ðŸ™ƒ,9:4]b"[120]) -> true[104]
  257:[105] GotoFalseWord(jump=263, if_false=true[104])
  260:[104] GotoWord(jump=332)
  332:[104] FreeText(var[80])
  335:[104] FreeText(var[56])
  338:[104] FreeText(var[32])
  341:[104] FreeText(var[8])
  344:[104] Return(ret=4294967295[4], value=0, discard=100)
Finished
