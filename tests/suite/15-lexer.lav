use lexer;

fn main() {
    l = lexer::Lexer {};
    l.set_tokens(["+=", "*=", "-=", "<=", ">=", "!=", "==", ">>", "<<", "->", "=>", ">>>", "..", "..=", "&&", "||"]);
    l.set_keywords(["for", "in", "if", "else", "fn", "pub", "use", "struct", "enum", "match", "and", "or"]);
    l.parse_string("Tokens", "12 += -2 * 3l >> 4");
    assert(l.int() == 12, "Integer");
    assert(!l.matches("+"), "Incorrect plus");
    assert(l.peek() != "+", "Incorrect plus");
    assert(l.matches("+="), "Incorrect plus_is");
    assert(l.int() == -2, "Second integer");
    assert(l.matches("*"), "Incorrect multiply");
    assert(l.int() != 3, "Third number");
    assert(l.long_int() == 3, "Incorrect long");
    assert(l.position() == "Tokens:1:15", "Incorrect position {l.position()}");
    assert(!l.matches(">"), "Incorrect higher");
    assert(l.matches(">>"), "Incorrect logical shift");
    assert(l.position() == "Tokens:1:18", "Incorrect position {l.position()}");

    l.parse_string("Texts", "\"123\" + '4'");
    assert(l.constant_text() == "123", "Incorrect text literal");
    assert(l.matches("+"), "Incorrect add");
    assert(l.constant_character() == "123", "Incorrect text literal");

    l.parse_string("Comments", "// starting comments\n123 // same line comment\n// extra comment\n4");
    assert(!l.comment_behind(), "Initial comment not behind");
    assert(l.last_comment() == "starting comments", "Initial comment");
    assert(l.int() == 123, "Content integer");
    assert(l.comment_behind(), "Second comment is behind");
    assert(l.last_comment() == "same line comment\nextra comment", "Second comment");
    assert(!l.is_finished(), "Not Ready");
    assert(l.int() == 4, "Second integer");
    assert(l.last_comment() == "", "No remaining comment");
    assert(l.is_finished(), "Ready");

    l.parse_string("Formatting", "\"abc{{12 + 34}}def\"");
    assert(l.constant_text() == "abc", "Before formatting");
    assert(l.is_formatting(), "Formatting");
    l.set_formatting(false);
    assert(l.int() == 12, "First integer");
    assert(l.matches("+"), "Incorrect plus");
    assert(l.int() == 34, "Second integer");
    l.set_formatting(true);
    assert(l.matches("}}"), "Incorrect closing brace");
    assert(l.constant_text() == "def", "After formatting");
    assert(!l.is_formatting(), "Formatting");
}
